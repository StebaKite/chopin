<script type="text/javascript">

function controllaUnivocitaPiva(funzione) {

	if (funzione == "new") {
		var codpiva = $("#codpiva").val();
		var descliente = $("#descliente").val();

		if (codpiva != "") {
			var xmlhttp = new XMLHttpRequest();
		    xmlhttp.onreadystatechange = function() {
		        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
		            $( "#esitoControlloUnivocitaPiva" ).html(xmlhttp.responseText);
		            $( "#esitoPivaCliente" ).val(xmlhttp.responseText);
		        }
		    } 
		    xmlhttp.open("GET", "cercaPivaClienteFacade.class.php?modo=start&codpiva=" + codpiva + "&descliente=" + descliente, true);
		    xmlhttp.send();		
		}		
	}
	else {
		var codpiva = $("#codpiva_mod").val();
		var descliente = $("#descliente_mod").val();

		if (codpiva != "") {
			var xmlhttp = new XMLHttpRequest();
		    xmlhttp.onreadystatechange = function() {
		        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
		            $( "#esitoControlloUnivocitaPiva_mod" ).html(xmlhttp.responseText);
		            $( "#esitoPivaCliente_mod" ).val(xmlhttp.responseText);
		        }
		    } 
		    xmlhttp.open("GET", "cercaPivaClienteFacade.class.php?modo=start&codpiva=" + codpiva + "&descliente=" + descliente, true);
		    xmlhttp.send();		
		}				
	}
}

function controllaUnivocitaCfis(funzione) {

	if (funzione == "new") {
		var codfisc = $("#codfisc").val();

		if (codfisc != "") {
			var xmlhttp = new XMLHttpRequest();
		    xmlhttp.onreadystatechange = function() {
		        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
		            $( "#esitoControlloUnivocitaCfis" ).html(xmlhttp.responseText);
		            $( "#esitoCfisCliente" ).val(xmlhttp.responseText);
		        }
		    } 
		    xmlhttp.open("GET", "cercaCfisClienteFacade.class.php?modo=start&codfisc=" + codfisc, true);
		    xmlhttp.send();		
		}		
	}
	else {
		var codfisc = $("#codfisc_mod").val();

		if (codfisc != "") {
			var xmlhttp = new XMLHttpRequest();
		    xmlhttp.onreadystatechange = function() {
		        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
		            $( "#esitoControlloUnivocitaCfis_mod" ).html(xmlhttp.responseText);
		            $( "#esitoCfisCliente_mod" ).val(xmlhttp.responseText);
		        }
		    } 
		    xmlhttp.open("GET", "cercaCfisClienteFacade.class.php?modo=start&codfisc=" + codfisc, true);
		    xmlhttp.send();		
		}		
	}
}

function normalizzaCampo(campo) {

	var c = $("#" + campo).val();
	var cNorm = c.trim().replace("&", "e");
	$("#" + campo).val(cNorm);	
}

$(document).ready( function () {
    $('#clienti').dataTable( {
    	"order": [[1, 'asc']],
    	"columnDefs": [
    	    {"targets": 0, "orderable": false },
    	    {"targets": 7, "orderable": false },
    	    {"targets": 8, "orderable": false }
    		],
   		"language": {
               "lengthMenu": "Visualizza _MENU_ righe per pagina",
               "zeroRecords": "La ricerca non ha prodotto risultati",
               "info": "Pagina _PAGE_ di _PAGES_",
               "infoEmpty": "La ricerca non ha prodotto risultati",
               "infoFiltered": "(righe filtrate da _MAX_ totali)",
               "search": "Cerca:",
               "paginate": {
                   "first":      "Prima",
                   "last":       "Ultima",
                   "next":       "Prossima",
                   "previous":   "Precedente"
               }
        },
        "lengthMenu": [ 15, 20, 25, 50, 75, 100 ]
    } );
} );

</script>

<div id="body">
	<div id="main">
		<table style="width:100%;">
			<tbody>
				<tr>
					<td align="left"><h2>%titoloPagina%</h2></td>
					<td align="right"><button id="nuovo-cliente" class="button">%ml.nuovocliente%</button></td>
				</tr>
			</tbody>
		</table>
		<br/>
		<table id="clienti" class="display" cellspacing="0" width="100%">%risultato_ricerca%</table>
	</div>	
		
	<div id="nuovo-cliente-form" title="Nuovo Cliente"> 
		<form method="post" id="nuovoCliente" action="../anagrafica/creaClienteFacade.class.php?modo=go" >

			<table class="datiCreate" cellpadding="5px">
				<tbody>
					<tr>
						<td>%ml.categoria% :</td>
						<td class="tooltip">
							<select class="selectmenuCategoria" id="catcliente" name="catcliente" >
								<option value=""></option>
								%elenco_categorie_cliente%
							</select>
						</td>
					</tr>					
					<tr>
						<td>%ml.codcliente% :</td>
						<td class="tooltip">
							<input type="text" id="codcliente" name="codcliente" size="12" maxlength="10" value='%codcliente%' >&nbsp;&nbsp;&nbsp;
							<i>(Codice cliente proposto disponibile)</i>
						</td>
					</tr>
					<tr>
						<td>%ml.descliente% :</td>
						<td class="tooltip"><input type="text" id="descliente" name="descliente" size="70" maxlength="100" value='%descliente%' onblur="normalizzaCampo('descliente');"></td>
					</tr>			
					<tr>
						<td>%ml.desindirizzocliente% :</td>
						<td class="tooltip"><input type="text" id="indcliente" name="indcliente" size="70" maxlength="200" value='%indcliente%' onblur="normalizzaCampo('indcliente');"></td>
					</tr>			
					<tr>
						<td>%ml.descittacliente% :</td>
						<td class="tooltip"><input type="text" id="cittacliente" name="cittacliente" size="70" maxlength="100" value='%cittacliente%' onblur="normalizzaCampo('cittacliente');"></td>
					</tr>			
					<tr>
						<td>%ml.capcliente% :</td>
						<td class="tooltip"><input type="text" id="capcliente" name="capcliente" size="7" maxlength="5" value='%capcliente%' onblur="normalizzaCampo('capcliente');"></td>
					</tr>	
					<tr>
						<td>%ml.tipaddebito% :</td>						
						<td>
							<div class="radioset" >
								<input type="radio" id="bonifico" name="tipoaddebito" value="BONIFICO" checked ><label for="bonifico">%ml.bonifico%</label>
								<input type="radio" id="riba" name="tipoaddebito" value="RIBA" ><label for="riba">%ml.riba%</label>
								<input type="radio" id="rimdiretta" name="tipoaddebito" value="RIM_DIR" ><label for="rimdiretta">%ml.rimdiretta%</label>
								<input type="radio" id="assegnobancario" name="tipoaddebito" value="ASS_BAN" ><label for="assegnobancario">%ml.assegnobancario%</label>
								<input type="radio" id="addebitodiretto" name="tipoaddebito" value="ADD_DIR" ><label for="addebitodiretto">%ml.addebitodiretto%</label>
							</div>
						</td>					
					</tr>					
					<tr>
						<td>%ml.pivacliente% :</td>
						<td class="tooltip">
							<input type="text" id="codpiva" name="codpiva" size="15" maxlength="11" value='%codpiva%' onblur="controllaUnivocitaPiva('new');" >&nbsp;&nbsp;&nbsp;
							<i id="esitoControlloUnivocitaPiva">&nbsp;</i>
						</td>
					</tr>					
					<tr>
						<td>%ml.cfiscliente% :</td>
						<td class="tooltip">
							<input type="text" id="codfisc" name="codfisc" size="20" maxlength="16" value='%codfisc%' onblur="controllaUnivocitaCfis('new');" >&nbsp;&nbsp;&nbsp;
							<i id="esitoControlloUnivocitaCfis">&nbsp;</i>
						</td>
					</tr>					
				</tbody>
			</table>
			<input type="hidden" id="esitoPivaCliente" name="esitoPivaCliente" />						
			<input type="hidden" id="esitoCfisCliente" name="esitoCfisCliente" />						
			
		</form>
	</div>
		
	<div id="cancella-cliente-form" title="Cancella Cliente"> 
		<form method="post" id="cancellaCliente" action="../anagrafica/cancellaClienteFacade.class.php?modo=start" >
			<p>Elimino il cliente ?</p>
			<input type="hidden" id="idcliente" name="idcliente">
		</form>
	</div>

	<div id="modifica-cliente-form" title="Modifica Cliente"> 
		<form method="post" id="modificaCliente" action="../anagrafica/modificaClienteFacade.class.php?modo=go" >
			<table class="datiCreate" cellpadding="5px">
				<tbody>
					<tr>
						<td>%ml.categoria% :</td>
						<td class="tooltip">
							<select class="selectmenuCategoria" id="catcliente_mod" name="catcliente_mod" ></select>
						</td>
					</tr>					
					<tr>
						<td>%ml.codcliente% :</td>
						<td class="tooltip"><input type="text" id="codcliente_mod" name="codcliente_mod" size="12" maxlength="10"/></td>
					</tr>
					<tr>
						<td>%ml.descliente% :</td>
						<td class="tooltip"><input type="text" id="descliente_mod" name="descliente_mod" size="70" maxlength="100" onblur="normalizzaCampo('descliente');"/></td>
					</tr>			
					<tr>
						<td>%ml.desindirizzocliente% :</td>
						<td class="tooltip"><input type="text" id="indcliente_mod" name="indcliente_mod" size="70" maxlength="200" onblur="normalizzaCampo('indcliente');"/></td>
					</tr>			
					<tr>
						<td>%ml.descittacliente% :</td>
						<td class="tooltip"><input type="text" id="cittacliente_mod" name="cittacliente_mod" size="70" maxlength="100" onblur="normalizzaCampo('cittacliente');"/></td>
					</tr>			
					<tr>
						<td>%ml.capcliente% :</td>
						<td class="tooltip"><input type="text" id="capcliente_mod" name="capcliente_mod" size="7" maxlength="5" onblur="normalizzaCampo('capcliente');"/></td>
					</tr>	
					<tr>
						<td>%ml.tipaddebito% :</td>						
						<td>
							<div class="radioset" >
								<input type="radio" id="bonifico_mod" name="tipoaddebito_mod" value="BONIFICO" /><label for="bonifico_mod">Bonifico</label>
								<input type="radio" id="riba_mod" name="tipoaddebito_mod" value="RIBA" /><label for="riba_mod">Ri.Ba.</label>
								<input type="radio" id="rimdiretta_mod" name="tipoaddebito_mod" value="RIM_DIR" /><label for="rimdiretta_mod">Rimessa diretta</label>
								<input type="radio" id="assegnobancario_mod" name="tipoaddebito_mod" value="ASS_BAN" /><label for="assegnobancario_mod">Assegno bancario</label>
								<input type="radio" id="addebitodiretto_mod" name="tipoaddebito_mod" value="ADD_DIR" /><label for="addebitodiretto_mod">Addebito diretto</label>
							</div>
						</td>					
					</tr>
					<tr>
						<td>%ml.pivacliente% :</td>
						<td class="tooltip">
							<input type="text" id="codpiva_mod" name="codpiva_mod" size="15" maxlength="11" onblur="controllaUnivocitaPiva('mod');" />&nbsp;&nbsp;&nbsp;
							<i id="esitoControlloUnivocitaPiva_mod">&nbsp;</i>
						</td>
					</tr>					
					<tr>
						<td>%ml.cfiscliente% :</td>
						<td class="tooltip">
							<input type="text" id="codfisc_mod" name="codfisc_mod" size="20" maxlength="16" onblur="controllaUnivocitaCfis('mod');" />&nbsp;&nbsp;&nbsp;
							<i id="esitoControlloUnivocitaCfis_mod">&nbsp;</i>
						</td>
					</tr>					
				</tbody>
			</table>
			<input type="hidden" id="esitoPivaCliente_mod" name="esitoPivaCliente_mod" />
			<input type="hidden" id="esitoCfisCliente_mod" name="esitoCfisCliente_mod" />		
		</form>
	</div>
		