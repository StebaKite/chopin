<body>

<script type="text/javascript">

var indexDettInseriti = [%arrayIndexDettagliInseriti%];
var dettInseriti = [%arrayDettagliInseriti%];

function aggiungiDettaglio() {
	
	var rowCount = $('#dettagli tr').length;
	
	if (rowCount == 0) {
		$( "#dettagli thead" ).append("<tr>" + 
			"<th width='350' align='left'>Conto</th>" + 
			"<th width='100' align='right'>Importo</th>" + 
			"<th width='50' align='center'>D/A</th>" +
			"<th>&nbsp;</th>" +
			"</tr>");
		$( "#dettagli" ).addClass("datiCreateSottile");
	}
	
	if($('#dare').is(':checked')) { var D_A = $("#dare").val(); }
	if($('#avere').is(':checked')) { var D_A = $("#avere").val(); }

	var conto = $("#conti").val();	
	var idconto = conto.substring(0, 6);
	var importo = $("#importo").val();
	var importoNormalizzato = importo.trim().replace(",", ".");
	
	$( "#dettagli tbody" ).append( "<tr id='" + idconto.trim() + "'>" +
        "<td align='left'>" + conto + "</td>" +
        "<td align='right'>" + importoNormalizzato + "</td>" +
        "<td align='center'>" + D_A + "</td>" +
    	"<td id='icons'><a class='tooltip' onclick='cancellaDettaglioPagina(" + idconto + ")'><li class='ui-state-default ui-corner-all' title='Cancella'><span class='ui-icon ui-icon-trash'></span></li></a></td>" +
      "</tr>" );
	
	var elemento = conto + "#" + importoNormalizzato + "#" + D_A;
	addDett(elemento);
	
	$("#importo").val("");
	$('#conti').prop("selectedIndex",0).selectmenu('refresh');
	$('#dare').attr('checked', true);
	
}

function addDett(dettaglio) {
	
	dettInseriti.push(dettaglio);
	aggiornaDettaglioInseriti(dettInseriti);

	var conto = dettaglio.substring(0, 6).trim();
	indexDettInseriti.push(conto);
	aggiornaIndexDettaglioInseriti(indexDettInseriti);
}

function aggiornaDettaglioInseriti(dettInseriti) {

/* 	var str = "<input type='text' size='150' name='dettagliInseriti' id='dettagliInseriti' value='";
    var inpHidden = str.concat(dettInseriti,"'/>");
 */
 $("#dettagliInseriti").val(dettInseriti);
}

function aggiornaIndexDettaglioInseriti(indexDettInseriti) {

/* 	var str1 = "<input type='text' size='150' name='indexDettagliInseriti' id='indexDettagliInseriti' value='";
    var inpHidden = str1.concat(indexDettInseriti,"'/>");
 */    
	$("#indexDettagliInseriti").val(indexDettInseriti);
}

</script>
	
<div id="body">
	<div id="main">
		<h2>%titoloPagina%</h2>

		<form method="post" action="%azione%" >
			<table class="datiCreate" cellpadding="5px">
				<tbody>
					<tr>
						<td class="td">%ml.datareg% :</td>
						<td class="tooltip"><input class="datepicker" type="text" name="datareg" size="10" maxlength="10" value='%datareg%' ></td>

						<td>%ml.codcau% :</td>
						<td class="tooltip">
							<select class="selectmenuCausale" id="causale" name="causale" >
								<option value=""></option>
								%elenco_causali%
							</select>
						</td>
					</tr>
					<tr>
						<td>%ml.descreg% :</td>
						<td colspan="4" class="tooltip"><input type="text" name="descreg" size="80" maxlength="200" value='%descreg%' ></td>
					</tr>					
					<tr>
						<td class="td">%ml.datascad% :</td>
						<td class="tooltip"><input class="datepicker" type="text" name="datascad" size="10" maxlength="10" value='%datascad%' ></td>
						<td>%ml.numfatt% :</td>
						<td class="tooltip"><input type="text" name="numfatt" size="35" maxlength="35" value='%numfatt%' ></td>
					</tr>
					<tr>
						<td>%ml.codforn% :</td>
						<td class="tooltip">
							<select class="selectmenuFornitore" name="fornitore" >
								<option value=""></option>
								%elenco_fornitori%
							</select>
						</td>
						
						<td>%ml.codclie% :</td>
						<td class="tooltip">
							<select class="selectmenuCliente" name="cliente" >
								<option value=""></option>
								%elenco_clienti%
							</select>
						</td>
					</tr>					
					<tr>
						<td colspan="4">
							<table id="dettagli" class="%class_dettagli%">
							    <thead>%thead_dettagli%</thead>
							    <tbody>%tbody_dettagli%</tbody>
							</table>			
						</td>
					</tr>										
				</tbody>
				<tfoot>
					<tr>
						<td colspan="6" align="right" class="tooltip"><button id="nuovo-dett" class="button" title="%ml.nuovoDettTip%" >%ml.nuovoDett%</button></td>
						<td colspan="6" align="right" class="tooltip"><button id="salva" class="button" title="%ml.salvaTip%" >%ml.salva%</button></td>
					</tr>
				</tfoot>
			</table>
			<input type="hidden" size='150' id="dettagliInseriti" name="dettagliInseriti" value="%dettagliInseriti%" />
			<input type="hidden" size='150' id="indexDettagliInseriti" name="indexDettagliInseriti" value="%arrayIndexDettagliInseriti%" />
		</form>
	</div>
</div>

<div id="nuovo-dettaglio-form" title="Nuovo Dettaglio"> 
	<form>
		<table class="datiCreate" cellpadding="5px">
			<tbody>
				<tr>
					<td>%ml.importo% :</td>
					<td class="tooltip"><input class="spinner" id="importo" name="importo" size="20" maxlength="20" ></td>
				</tr>					
				<tr>
					<td>%ml.conto% :</td>
					<td>
						<select class='selectmenuConto' id="conti">%elenco_conti%</select>
					</td>
				</tr>	
				<tr>
					<td>
						<div class="radioset" >
							<input type="radio" id="dare" name="dareavere" value="D" checked ><label for="dare">%ml.dare%</label>
							<input type="radio" id="avere" name="dareavere" value="A" ><label for="avere">%ml.avere%</label>
						</div>
					</td>					
				</tr>					
			</tbody>
		</table> 	 
  </form>
</div>

<br/>